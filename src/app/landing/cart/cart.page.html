<app-header-landing></app-header-landing>

<ion-content [fullscreen]="true" class="container-page">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Carrito</ion-title>
    </ion-toolbar>
  </ion-header>

  <!-- Carrito vac칤o -->
  <div *ngIf="cartItems.length === 0" class="empty-cart">
    <ion-icon name="cart-outline" class="empty-cart-icon"></ion-icon>
    <h2>Tu carrito est치 vac칤o</h2>
    <p>Agrega productos para comenzar tu compra</p>
  </div>

  <!-- Carrito con items -->
  <div *ngIf="cartItems.length > 0" class="cart-container">
    <!-- Lista de productos -->
    <ion-list class="cart-items">
      <ion-item *ngFor="let item of cartItems" class="cart-item">
        <img [src]="item.product.image" [alt]="item.product.name" class="item-image" />

        <div class="item-details">
          <div class="item-info">
            <h3>{{ item.product.name }}</h3>
            <p class="item-color">Color: {{ item.selectedColor }}</p>
            <p class="item-price">${{ item.product.price | number:'1.2-2' }}</p>
          </div>

          <div class="item-controls">
            <div class="quantity-control">
              <ion-button fill="clear" size="small" (click)="decreaseQuantity(item)">
                <ion-icon slot="icon-only" name="remove"></ion-icon>
              </ion-button>

              <span class="quantity">{{ item.quantity }}</span>

              <ion-button fill="clear" size="small" (click)="increaseQuantity(item)">
                <ion-icon slot="icon-only" name="add"></ion-icon>
              </ion-button>
            </div>

            <p class="item-subtotal">${{ item.subtotal | number:'1.2-2' }}</p>

            <ion-button fill="clear" color="danger" size="small" (click)="removeItem(item)">
              <ion-icon slot="icon-only" name="trash"></ion-icon>
            </ion-button>
          </div>
        </div>
      </ion-item>
    </ion-list>

    <!-- Resumen -->
    <ion-card class="cart-summary">
      <ion-card-content>
        <h2>Resumen del Pedido</h2>

        <div class="summary-row">
          <span>Productos ({{ cartSummary.totalItems }})</span>
          <span>${{ cartSummary.totalPrice | number:'1.2-2' }}</span>
        </div>

        <div class="summary-row">
          <span>Env칤o</span>
          <span>Gratis</span>
        </div>

        <div class="summary-divider"></div>

        <div class="summary-row summary-total">
          <span>Total</span>
          <span>${{ cartSummary.totalPrice | number:'1.2-2' }}</span>
        </div>

        <!-- Botones -->
        <ion-button expand="block" class="checkout-btn" (click)="openFormModal()">
          Procesar Pedido
        </ion-button>

        <ion-button expand="block" fill="outline" color="danger" (click)="clearCart()">
          Vaciar Carrito
        </ion-button>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- 游뿏 MODAL ELEGANTE DE DATOS DE ENV칈O -->
  <ion-modal [isOpen]="showFormModal" (didDismiss)="closeFormModal()" class="animated-modal">
    <ng-template>
      <ion-content class="payment-modal">
        <ion-card>
          <ion-card-header>
            <ion-card-title>Datos de env칤o</ion-card-title>
            <ion-card-subtitle>Completa tu informaci칩n antes del pago</ion-card-subtitle>
          </ion-card-header>

          <ion-card-content>
            <form (ngSubmit)="submitCheckout()" #formEnvio="ngForm">

              <ion-item>
                <ion-label position="floating">Nombre completo</ion-label>
                <ion-input type="text" [(ngModel)]="formData.name" name="name" required></ion-input>
              </ion-item>

              <ion-item>
                <ion-label position="floating">Correo electr칩nico</ion-label>
                <ion-input type="email" [(ngModel)]="formData.email" name="email" required></ion-input>
              </ion-item>

              <ion-item>
                <ion-label position="floating">Direcci칩n</ion-label>
                <ion-input type="text" [(ngModel)]="formData.address" name="address" required></ion-input>
              </ion-item>

              <ion-item>
                <ion-label position="floating">C칩digo postal</ion-label>
                <ion-input type="text" [(ngModel)]="formData.postalCode" name="postalCode" required></ion-input>
              </ion-item>

              <ion-item>
                <ion-label position="floating">Casa o apartamento</ion-label>
                <ion-input type="text" [(ngModel)]="formData.apartment" name="apartment"></ion-input>
              </ion-item>

              <ion-item>
                <ion-label position="floating">Barrio</ion-label>
                <ion-input type="text" [(ngModel)]="formData.neighborhood" name="neighborhood"></ion-input>
              </ion-item>

              <ion-item>
                <ion-label position="floating">Ciudad</ion-label>
                <ion-input type="text" [(ngModel)]="formData.city" name="city" required></ion-input>
              </ion-item>

              <ion-item>
                <ion-label position="floating">Tel칠fono</ion-label>
                <ion-input type="tel" [(ngModel)]="formData.phone" name="phone" required></ion-input>
              </ion-item>

              <div class="modal-buttons">
                <ion-button expand="block" color="success" type="submit">
                  Continuar con el pago
                </ion-button>
                <ion-button expand="block" color="medium" (click)="closeFormModal()">
                  Cancelar
                </ion-button>
              </div>
            </form>
          </ion-card-content>
        </ion-card>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>
